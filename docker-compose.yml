# docker-compose.yml
# KD Race App â€“ Docker configuration
# ðŸ”§ Combined backend (API) and frontend (React) into a single service for standalone deployment

services:
  # ðŸš€ kd_web â€“ Node.js + Express + Prisma + Frontend + Nginx
  kd_web:
    build:
      context: ./web          # âœ… updated from ./api
      dockerfile: Dockerfile
      args:
        NODE_ENV: production
    container_name: kd_web
    working_dir: /usr/src/app
    user: "node"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgres://derby_admin:${DB_PASS}@192.168.50.209:5432/derby
      - API_ADMIN_PASS=${API_ADMIN_PASS}
    ports:
      - "4000:4000"  # API
      - "8086:80"  # Frontend
    restart: unless-stopped
    networks:
      - kd_net

networks:
  kd_net:
    name: kd_net
    driver: bridge
