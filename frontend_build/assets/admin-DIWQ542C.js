import{j as e,r,c as re,a as le}from"./index-DqS0zHq-.js";import{a as h}from"./index-xsH4HHeE.js";function oe({raceState:s,status:l,warnings:a,onResetRace:c}){const n=(s==null?void 0:s.id)||"â€”",i=(s==null?void 0:s.name)||"â€”",p=!!(s!=null&&s.endedAt),o=s&&!s.betsLocked,f=s?p?"Ended":o?"Bets Open":"Waiting":"No race yet";return e.jsxs("div",{className:"text-center space-y-2 text-gray-700",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"ðŸŽ JLL Derby Admin Panel"}),e.jsxs("div",{children:["Race ID: ",n," â€¢ Name: ",i," â€¢ Status: ",f]}),e.jsx("div",{className:"text-gray-500",children:l}),a.length>0&&e.jsxs("div",{className:"p-2 bg-yellow-100 border border-yellow-400 rounded text-yellow-800 text-xs",children:[e.jsx("strong",{children:"Warnings:"}),e.jsx("ul",{className:"list-disc list-inside",children:a.map((y,N)=>e.jsx("li",{children:y},N))}),e.jsx("button",{onClick:c,className:"mt-2 px-2 py-1 bg-red-600 text-white rounded text-sm",children:"ðŸ—‘ï¸ Reset Race"})]})]})}function de({isRaceReady:s,allowGenerateRace:l,isFinalRace:a,canOpenBets:c,canStartRace:n,betCountdown:i,countdownDisplay:p,onAction:o,onOpenBets:f,showReset:y}){return e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsx("button",{disabled:!l,onClick:()=>o(a?"final-race":"generate-race"),className:`px-4 py-2 rounded text-white ${l?"bg-blue-600":"bg-gray-300"}`,children:a?"ðŸŽ‰ Generate Final Race":"ðŸŽ² Generate Race"}),e.jsxs("button",{disabled:!c,onClick:f,className:`px-4 py-2 rounded text-white ${c?"bg-green-600":"bg-gray-300"}`,children:["ðŸ“ˆ Open Bets ",i!==null&&e.jsxs("span",{children:["â±ï¸ ",p]})]}),e.jsx("button",{disabled:!n,onClick:()=>o("start-race"),className:`px-4 py-2 rounded text-white ${n?"bg-red-600":"bg-gray-300"}`,children:"ðŸ Start Race"}),y&&e.jsx("button",{onClick:()=>{window.confirm(`âš ï¸ This will delete all races and results.
Users and Lease Loons will be preserved.

Proceed?`)&&o("reset-tournament")},className:"px-4 py-2 rounded text-white bg-yellow-600 hover:bg-yellow-700",children:"â™»ï¸ Reset Races"})]})}function ce({showRaces:s,setShowRaces:l,raceState:a,pastRaces:c}){var i;const n=p=>e.jsx("div",{className:"grid grid-cols-4 gap-2 text-sm mt-2",children:p.map((o,f)=>e.jsxs("div",{className:"rounded border p-2 bg-gray-50 text-center",children:[e.jsx("div",{className:"font-bold",children:o.horse.name}),e.jsx("div",{className:"text-xs italic",children:o.horse.color}),e.jsxs("div",{children:[["ðŸ¥‡","ðŸ¥ˆ","ðŸ¥‰"][f]||`${f+1}th`," â€“"," ",e.jsxs("span",{className:"text-gray-700",children:[(o.timeMs/1e3).toFixed(3),"s"]})]})]},o.horse.id))});return e.jsxs("div",{children:[e.jsx("button",{onClick:()=>l(!s),className:"w-full py-3 px-4 bg-red-100 hover:bg-red-200 text-red-800 rounded shadow-sm font-medium",children:s?"Hide Races ðŸ“‹":"Show Races ðŸ“‹"}),s&&e.jsxs("div",{className:"mt-4 border p-4 rounded bg-white space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold mb-2",children:["Current Race: ",(a==null?void 0:a.name)||"â€”"]}),((i=a==null?void 0:a.results)==null?void 0:i.length)>0?n(a.results):e.jsx("p",{className:"text-gray-500",children:"No results yet"}),c.map(p=>{var o;return e.jsxs("details",{className:"border p-2 rounded",children:[e.jsxs("summary",{className:"cursor-pointer font-semibold",children:["ðŸ ",p.name]}),((o=p.results)==null?void 0:o.length)>0?n(p.results):e.jsx("p",{className:"text-gray-500",children:"No results recorded"})]},p.id)})]})]})}function ie({betSeconds:s,setBetSeconds:l,confirmOpenBets:a,onCancel:c}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded shadow-lg text-center space-y-4 max-w-xs w-full",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Set Bet Timer"}),e.jsx("input",{type:"number",inputMode:"decimal",value:s,onChange:n=>l(n.target.value),placeholder:"Enter seconds",className:"w-full px-3 py-2 border border-gray-400 rounded text-center"}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 bg-green-600 text-white rounded",children:"Confirm"}),e.jsx("button",{onClick:c,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded",children:"Cancel"})]})]})})}function ue({users:s,showUsers:l,setShowUsers:a,updateUser:c}){return e.jsxs("div",{className:"mt-6",children:[e.jsx("button",{onClick:()=>a(!l),className:"w-full py-3 px-4 bg-gray-100 text-gray-800 rounded shadow-sm font-medium",children:l?"Hide User Editor ðŸ‘¥":"Manage Users ðŸ‘¥"}),l&&e.jsx("div",{className:"mt-4 overflow-x-auto border rounded shadow-sm bg-white",children:e.jsxs("table",{className:"w-full min-w-[600px] text-xs text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 uppercase tracking-wide",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 border",children:"Device ID"}),e.jsx("th",{className:"px-3 py-2 border",children:"First"}),e.jsx("th",{className:"px-3 py-2 border",children:"Last"}),e.jsx("th",{className:"px-3 py-2 border",children:"Nickname"}),e.jsx("th",{className:"px-3 py-2 border",children:"Loons"})]})}),e.jsx("tbody",{children:s.map(n=>e.jsxs("tr",{className:"odd:bg-gray-50 even:bg-white",children:[e.jsx("td",{className:"px-3 py-1 border break-all",children:n.deviceId}),e.jsx("td",{className:"px-3 py-1 border",children:e.jsx("input",{className:"w-full bg-transparent border border-gray-300 rounded px-1",defaultValue:n.firstName,onBlur:i=>c(n.deviceId,{firstName:i.target.value})})}),e.jsx("td",{className:"px-3 py-1 border",children:e.jsx("input",{className:"w-full bg-transparent border border-gray-300 rounded px-1",defaultValue:n.lastName,onBlur:i=>c(n.deviceId,{lastName:i.target.value})})}),e.jsx("td",{className:"px-3 py-1 border",children:e.jsx("input",{className:"w-full bg-transparent border border-gray-300 rounded px-1",defaultValue:n.nickname,onBlur:i=>c(n.deviceId,{nickname:i.target.value})})}),e.jsx("td",{className:"px-3 py-1 border",children:e.jsx("input",{className:"w-16 bg-transparent border border-gray-300 rounded px-1 text-right",type:"number",inputMode:"numeric",defaultValue:n.leaseLoons,onBlur:i=>c(n.deviceId,{leaseLoons:parseInt(i.target.value)})})})]},n.deviceId))})]})})]})}function me({showDevTools:s,setShowDevTools:l,handleDevReset:a}){return e.jsxs("div",{className:"mt-6",children:[e.jsx("button",{onClick:()=>l(!s),className:"w-full py-3 px-4 bg-yellow-100 text-yellow-900 rounded shadow-sm font-medium",children:s?"Hide Dev Tools ðŸ› ":"Show Dev Tools ðŸ› "}),s&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>a("tournament"),className:"bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded",children:"ðŸ§¹ Reset Races & Horses"}),e.jsx("button",{onClick:()=>a("loons"),className:"bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded",children:"ðŸ’° Reset Lease Loons"}),e.jsx("button",{onClick:()=>a("dev"),className:"bg-red-200 hover:bg-red-300 px-4 py-2 rounded",children:"âš ï¸ Full Dev Reset (seed-dev.ts)"}),e.jsx("button",{onClick:()=>a("seed"),className:"bg-red-400 hover:bg-red-500 px-4 py-2 rounded text-white font-bold",children:"ðŸ§¨ Reset Database (seed.ts)"})]})]})}const xe="6a2e8819c6fb4c15",g={"x-admin-pass":xe};function pe(){var F;const[s,l]=r.useState(!1),[a,c]=r.useState(!0),[n,i]=r.useState(""),[p,o]=r.useState(!1),[f,y]=r.useState(!1),[N,U]=r.useState([]),[M,T]=r.useState(!1),[O,m]=r.useState(""),[V,E]=r.useState([]),[u,v]=r.useState(null),[$,A]=r.useState([]),[H,G]=r.useState(!1),[w,W]=r.useState(()=>localStorage.getItem("betSeconds")||"60"),[D,R]=r.useState(null),[_,k]=r.useState(""),[z,C]=r.useState(!1),[J,q]=r.useState(!1),I=async()=>{try{const t=await h.get("/api/user/all",{headers:g});U(t.data)}catch{m("âŒ Error loading users")}},b=async()=>{try{const t=await h.get("/api/race/latest");t.data.exists===!1?v(null):(v(t.data),E(t.data.warnings||[]));const d=await h.get("/api/races");A(d.data||[])}catch{v(null),A([])}},K=async()=>{try{await h.post("/api/admin/close-bets",{},{headers:g}),m("âœ… Bets auto-closed"),await b()}catch{m("âŒ Failed to auto-close bets")}R(null)},Q=t=>{let d=Number(t);R(d);const x=setInterval(()=>{if(d-=1,d<=0)clearInterval(x),k(""),K();else{const j=Math.floor(d/60),P=String(d%60).padStart(2,"0");k(`${j}:${P}`)}},1e3)},B=async t=>{var d;try{if(t==="generate-race"||t==="final-race"){await h.post("/api/admin/clear-horses",{},{headers:g});const x=await h.post(`/api/admin/${t}`,{},{headers:g});m(t==="final-race"?"ðŸŽ‰ Final race generated":"âœ… Race generated"),E(((d=x.data)==null?void 0:d.warnings)||[]),R(null),k(""),await b(),t==="final-race"&&(y(!0),o(!0));return}if(t==="reset-tournament"){await h.post("/api/admin/reset-tournament",{},{headers:g}),m("â™»ï¸ Tournament reset successfully"),o(!1),y(!1),y(!1),await b();const x=window==null?void 0:window.raceSocket;x&&x.emit("admin:clear-stage");return}if(t==="open-bets"){C(!0);return}if(t==="clear-horses"){await h.post("/api/admin/clear-horses",{},{headers:g}),m("âœ… Race reset"),await b();return}await h.post(`/api/admin/${t}`,{},{headers:g}),m(`âœ… ${t.replace("-"," ")} succeeded`),await b()}catch{m(`âŒ ${t.replace("-"," ")} failed`)}},X=async()=>{localStorage.setItem("betSeconds",w),C(!1),Q(w);try{await h.post("/api/admin/open-bets",{seconds:w},{headers:g}),m(`âœ… Bets opened for ${w} seconds`),await b()}catch{m("âŒ Failed to open bets")}},Y=async(t,d)=>{const x=Object.keys(d)[0],j=d[x];if(window.confirm(`Update ${x} to "${j}"?`))try{await h.put(`/api/admin/user/${t}`,d,{headers:g}),m("âœ… User updated"),await I()}catch{m("âŒ Update failed")}},Z=async t=>{const d={tournament:{endpoint:"reset-tournament",confirm:"Reset all races, horses, and race names?",danger:!1},loons:{endpoint:"reset-loons",confirm:"Reset all user Lease Loons back to 1000?",danger:!1},dev:{endpoint:"reset-dev",confirm:"âš ï¸ FULL DEV RESET. This will reseed test data from seed-dev.ts. Continue?",danger:!0},seed:{endpoint:"seed-reset",confirm:"âš ï¸ This will hard reset the DB using seed.ts. Are you sure?",danger:!0}},{endpoint:x,confirm:j,danger:P}=d[t];if(window.confirm(j))try{await h.post(`/api/admin/${x}`,{},{headers:g}),m(`âœ… ${x.replace("-"," ")} complete`),await b(),await I()}catch{m(`âŒ ${x.replace("-"," ")} failed`)}};r.useEffect(()=>{localStorage.getItem("adminUIAuthenticated")==="true"&&(l(!0),c(!1),I(),b());const t=setInterval(b,2e3);return()=>clearInterval(t)},[]);const L=((F=u==null?void 0:u.horses)==null?void 0:F.length)>=4,ee=!!(u!=null&&u.endedAt),se=L&&(u==null?void 0:u.betsLocked)===!1,te=L&&D===null&&(u==null?void 0:u.betsLocked)===!0,ae=$.length,S=!u||ee,ne=f||ae>=4&&S;return e.jsxs("div",{className:"p-4 text-gray-800 space-y-6 max-w-5xl mx-auto",children:[e.jsx(oe,{raceState:u,status:O,warnings:V,onResetRace:()=>B("clear-horses")}),e.jsx(de,{allowGenerateRace:S,isFinalRace:ne,showReset:p,isRaceReady:L,canOpenBets:se,canStartRace:te,betCountdown:D,countdownDisplay:_,onAction:B,onOpenBets:()=>B("open-bets")}),e.jsx(ce,{showRaces:H,setShowRaces:G,raceState:u,pastRaces:$}),z&&e.jsx(ie,{betSeconds:w,setBetSeconds:W,confirmOpenBets:X,onCancel:()=>C(!1)}),e.jsx(ue,{users:N,showUsers:M,setShowUsers:T,updateUser:Y}),e.jsx(me,{showDevTools:J,setShowDevTools:q,handleDevReset:Z})]})}re.createRoot(document.getElementById("root")).render(e.jsx(le.StrictMode,{children:e.jsx(pe,{})}));
