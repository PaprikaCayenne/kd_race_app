# Stage 1: Build the Vite app
FROM node:18-alpine AS builder
WORKDIR /app

# âœ… Create a matching media-apps user (UID 1007) instead of 1000
RUN addgroup -g 1007 media-apps && adduser -D -G media-apps -u 1007 media-apps

# ğŸ“¦ Install deps
COPY package.json package-lock.json* ./
RUN npm install

# ğŸ“ Copy source and build
COPY . .
RUN npm run build

# âœ… Fix ownership of dist
RUN chown -R media-apps:media-apps /app/dist

# Stage 2: Serve with nginx
FROM nginx:alpine

# âœ… Add same user (UID 1007)
RUN addgroup -g 1007 media-apps && adduser -D -G media-apps -u 1007 media-apps

# âš™ï¸ Copy built files with correct ownership
COPY --from=builder /app/dist /usr/share/nginx/html
RUN chown -R media-apps:media-apps /usr/share/nginx/html

# ğŸ”’ (Optional) Run as media-apps user
# USER media-apps
